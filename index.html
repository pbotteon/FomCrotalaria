<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formul√°rio de An√°lise de Risco - Intoxica√ß√£o por Crotal√°ria</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background: linear-gradient(135deg, #f5f9f5 0%, #e8f5e8 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #2c7d4a 0%, #1e5d35 100%); color: white; padding: 30px 20px; border-radius: 12px; margin-bottom: 30px; text-align: center; box-shadow: 0 4px 20px rgba(44, 125, 74, 0.3); }
        .header h1 { font-size: 2rem; margin-bottom: 10px; }
        .header h2 { font-size: 1.2rem; opacity: 0.9; font-weight: 300; }
        .progress-container { background: white; border-radius: 50px; padding: 4px; margin: 30px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .progress-bar { height: 12px; background: linear-gradient(90deg, #2c7d4a, #4caf50); border-radius: 50px; width: 0%; transition: width 0.5s ease; }
        .progress-text { text-align: center; margin-top: 10px; font-weight: 500; color: #2c7d4a; }
        .section { background: white; padding: 30px; margin-bottom: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid rgba(44, 125, 74, 0.1); }
        .section.hidden { display: none; }
        .section h2 { color: #2c7d4a; margin-bottom: 25px; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .section-icon { font-size: 1.8rem; }
        fieldset { border: 2px solid #e8f5e8; border-radius: 12px; padding: 25px; margin-bottom: 25px; background: #fafffe; }
        legend { font-weight: 600; color: #2c7d4a; padding: 0 15px; font-size: 1.1em; background: white; }
        .form-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .form-col { flex: 1; }
        label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }
        .required::after { content: " *"; color: #e74c3c; font-weight: bold; }
        input[type="text"], input[type="tel"], input[type="number"], input[type="date"], input[type="email"], select, textarea { width: 100%; padding: 14px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; transition: all 0.3s ease; background: white; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #2c7d4a; box-shadow: 0 0 0 3px rgba(44, 125, 74, 0.1); }
        .error-message { color: #e74c3c; font-size: 14px; margin-top: 5px; display: none; }
        .error-message.show { display: block; }
        .button-group { display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px; flex-wrap: wrap; }
        button { background: linear-gradient(135deg, #2c7d4a 0%, #1e5d35 100%); color: white; border: none; padding: 14px 28px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.3s ease; min-width: 140px; }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(44, 125, 74, 0.3); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .btn-secondary { background: linear-gradient(135deg, #6c757d 0%, #495057 100%); }
        .clinical-table { width: 100%; border-collapse: collapse; margin: 20px 0; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .clinical-table th { background: linear-gradient(135deg, #2c7d4a 0%, #1e5d35 100%); color: white; padding: 15px 12px; text-align: center; font-weight: 600; }
        .clinical-table td { padding: 15px 12px; border-bottom: 1px solid #e8f5e8; text-align: center; }
        .clinical-table td:first-child { text-align: left; font-weight: 500; }
        .checkbox-group label, .radio-group label { display: flex; align-items: center; margin: 12px 0; cursor: pointer; padding: 10px; border-radius: 6px; transition: background-color 0.2s; }
        .checkbox-group input, .radio-group input { margin-right: 12px; width: auto; transform: scale(1.2); }
        .info-box { background: #e3f7fd; border-left: 4px solid #2196F3; padding: 20px; margin: 20px 0; border-radius: 0 8px 8px 0; }
        .info-box.warning { background: #fff3cd; border-left-color: #ffc107; }
        .info-box.success { background: #d4edda; border-left-color: #28a745; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêé Formul√°rio de An√°lise de Risco</h1>
            <h2>Intoxica√ß√£o por Crotal√°ria em Equinos</h2>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-text" id="progress-text">Etapa 1 de 4</div>

        <div id="consent-section" class="section">
            <h2><span class="section-icon">üìã</span>Termo de Consentimento</h2>
            <div class="consent-terms" style="background: #f0f7f0; padding: 25px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #c8e6c9;">
                <p><strong>Este formul√°rio integra um estudo cient√≠fico sobre a contamina√ß√£o de ra√ß√£o equina por <i>Crotal√°ria</i> sp.</strong></p>
                <p>Ao preench√™-lo, voc√™ concorda que:</p>
                <ul style="margin: 15px 0 15px 20px;">
                    <li style="margin: 8px 0;">Os dados ser√£o usados para pesquisa epidemiol√≥gica;</li>
                    <li style="margin: 8px 0;">Resultados ser√£o publicados <strong>sem identificar</strong> propriedades, animais ou pessoas;</li>
                    <li style="margin: 8px 0;">A localiza√ß√£o e dados cl√≠nicos ser√£o analisados de forma agregada;</li>
                    <li style="margin: 8px 0;">O preenchimento, sempre que poss√≠vel, deve ser realizado ou supervisionado pelo veterin√°rio respons√°vel.</li>
                </ul>
                <p><strong>Seu preenchimento implica aceita√ß√£o destes termos.</strong></p>
            </div>
            <div class="consent-checkbox">
                <input type="checkbox" id="consent-checkbox" required>
                <label for="consent-checkbox">Li e concordo com os termos acima</label>
            </div>
            <div class="button-group">
                <button onclick="startForm()" id="start-button" disabled>Iniciar Formul√°rio</button>
            </div>
        </div>

        <div id="part1-section" class="section hidden">
            <h2><span class="section-icon">üè°</span>Dados da Propriedade</h2>
            <fieldset>
                <legend>Informa√ß√µes do Respons√°vel</legend>
                <div class="form-row"><div class="form-col"><label class="required">Nome do respons√°vel pelo preenchimento:</label><input type="text" id="responsible-name" placeholder="Nome completo" required><div class="error-message" id="responsible-name-error">Por favor, informe o nome completo</div></div></div>
                <div class="form-row"><div class="form-col"><label>Veterin√°rio respons√°vel pelo atendimento (opcional):</label><input type="text" id="vet-name" placeholder="Nome e CRMV"></div></div>
                <div class="form-row"><div class="form-col"><label class="required">Telefone para contato (WhatsApp):</label><input type="tel" id="telefone" placeholder="(00) 00000-0000" required><div class="error-message" id="telefone-error">Por favor, informe um telefone v√°lido</div></div></div>
            </fieldset>
            <fieldset>
                <legend>Dados da Propriedade</legend>
                <div class="form-row"><div class="form-col"><label class="required">Nome da propriedade:</label><input type="text" id="farm-name" placeholder="Ex: Fazenda Santa Maria" required><div class="error-message" id="farm-name-error">Por favor, informe o nome da propriedade</div></div></div>
                <div class="form-row"><div class="form-col"><label class="required">Localiza√ß√£o (Cidade/Estado):</label><input type="text" id="location" placeholder="Ex: Valen√ßa/RJ" required><div class="error-message" id="location-error">Por favor, informe a localiza√ß√£o</div></div></div>
            </fieldset>
            <fieldset>
                <legend>Dados do Rebanho</legend>
                <div class="form-row"><div class="form-col"><label class="required">N√∫mero total de cavalos no rebanho:</label><input type="number" id="total-horses" min="1" required><div class="error-message" id="total-horses-error">Informe um n√∫mero v√°lido</div></div></div>
                <div class="form-row"><div class="form-col"><label class="required">N√∫mero de cavalos que receberam a ra√ß√£o contaminada:</label><input type="number" id="exposed-horses" min="0" required><div class="error-message" id="exposed-horses-error">N√£o pode ser maior que o total</div></div></div>
                <div class="form-row"><div class="form-col"><label class="required">N√∫mero de cavalos que adoeceram:</label><input type="number" id="sick-horses" min="0" required><div class="error-message" id="sick-horses-error">N√£o pode ser maior que os expostos</div></div></div>
                <div class="form-row"><div class="form-col"><label class="required">N√∫mero de cavalos que morreram:</label><input type="number" id="dead-horses" min="0" required><div class="error-message" id="dead-horses-error">N√£o pode ser maior que os doentes</div></div></div>
            </fieldset>
            <div class="button-group">
                <button type="button" onclick="goToConsent()" class="btn-secondary">‚Üê Voltar</button>
                <button type="button" onclick="validatePart1()">Continuar para Dados Cl√≠nicos ‚Üí</button>
            </div>
        </div>

        <div id="part2-section" class="section hidden">
            <h2><span class="section-icon">üê¥</span>Sele√ß√£o de Animais</h2>
            <div class="info-box"><p><strong>Importante:</strong> Voc√™ informou que <span id="sick-count">0</span> cavalos adoeceram.</p></div>
            <div class="animal-counter"><p>Animais para avaliar: <span id="animals-to-evaluate">0</span></p><p>Avaliados: <span id="animals-evaluated">0</span></p></div>
            <fieldset>
                <legend>Op√ß√µes de Preenchimento</legend>
                <div class="radio-group">
                    <label><input type="radio" name="filling-option" value="all" checked> Preencher todos</label>
                    <label><input type="radio" name="filling-option" value="sample"> Preencher amostra</label>
                    <label><input type="radio" name="filling-option" value="skip"> Pular dados individuais</label>
                </div>
            </fieldset>
            <div class="button-group">
                <button type="button" onclick="goToPart1()" class="btn-secondary">‚Üê Voltar</button>
                <button type="button" onclick="startClinicalData()">Iniciar Dados Cl√≠nicos ‚Üí</button>
            </div>
        </div>

        <div id="part3-section" class="section hidden">
            <h2><span class="section-icon">üè•</span>Dados Cl√≠nicos Individuais</h2>
            <div class="info-box warning"><p><strong>Animal <span id="current-animal">1</span> de <span id="total-animals">1</span></strong></p></div>
            <fieldset>
                <legend>Identifica√ß√£o do Animal</legend>
                <div class="form-row"><div class="form-col"><label class="required">Identifica√ß√£o/Nome:</label><input type="text" id="animal-id" required><div class="error-message" id="animal-id-error"></div></div></div>
                <div class="form-row"><div class="form-col"><label class="required">Sexo:</label><select id="animal-sex" required><option value="">Selecione...</option><option value="male">Macho</option><option value="female">F√™mea</option></select><div class="error-message" id="animal-sex-error"></div></div><div class="form-col"><label class="required">Idade (anos):</label><input type="number" id="animal-age" min="0" required><div class="error-message" id="animal-age-error"></div></div></div>
            </fieldset>
            <div class="button-group">
                <button type="button" onclick="goToPart2()" class="btn-secondary">‚Üê Voltar</button>
                <button type="button" onclick="saveAnimalData()" id="save-animal">Salvar e Pr√≥ximo ‚Üí</button>
                <button type="button" onclick="finishClinicalData()" id="finish-clinical" style="display: none;">Finalizar ‚Üí</button>
            </div>
        </div>

        <div id="part4-section" class="section hidden">
            <h2><span class="section-icon">‚úÖ</span>Finaliza√ß√£o</h2>
            <div class="info-box success"><p><strong>Formul√°rio preenchido!</strong></p></div>
            <fieldset><legend>Resumo</legend><div id="summary-content"></div></fieldset>
            <div class="button-group">
                <button type="button" onclick="submitForm()" id="submit-form"><span id="submit-text">Enviar Formul√°rio</span></button>
            </div>
        </div>
    </div>

<script>
    // Vari√°veis globais
    let currentStep = 1;
    let currentAnimalIndex = 0;
    let totalAnimalsToEvaluate = 0;
    let animalsData = [];
    let fillingOption = 'all';
    let savedData = {
        propertyData: {},
        animalsData: []
    };

    // Fun√ß√£o principal que roda quando o DOM est√° pronto
    document.addEventListener('DOMContentLoaded', function() {
        setupEventListeners();
        updateProgress();
    });

    function setupEventListeners() {
        document.getElementById('consent-checkbox').addEventListener('change', function() {
            document.getElementById('start-button').disabled = !this.checked;
        });
        document.getElementById('telefone').addEventListener('input', (e) => formatarTelefone(e.target));
        ['total-horses', 'exposed-horses', 'sick-horses', 'dead-horses'].forEach(id => {
            document.getElementById(id).addEventListener('input', validateHerdNumbers);
        });
    }

    // Fun√ß√µes de Navega√ß√£o
    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(section => section.classList.add('hidden'));
        document.getElementById(sectionId).classList.remove('hidden');
    }

    function updateProgress() {
        document.getElementById('progress-bar').style.width = `${(currentStep / 4) * 100}%`;
        document.getElementById('progress-text').textContent = `Etapa ${currentStep} de 4`;
    }

    function startForm() {
        currentStep = 1;
        showSection('part1-section');
        updateProgress();
    }

    function goToConsent() {
        currentStep = 1;
        showSection('consent-section');
        updateProgress();
    }

    function goToPart1() {
        currentStep = 1;
        showSection('part1-section');
        updateProgress();
    }

    function goToPart2() {
        currentStep = 2;
        setupPart2();
        showSection('part2-section');
        updateProgress();
    }
    
    function goToPart3() {
        currentStep = 3;
        showSection('part3-section');
        updateProgress();
    }

    // Fun√ß√µes de Valida√ß√£o
    function validateField(id, errorId, message) {
        const field = document.getElementById(id);
        const errorElement = document.getElementById(errorId);
        if (!field.value.trim()) {
            errorElement.textContent = message;
            errorElement.classList.add('show');
            return false;
        }
        errorElement.classList.remove('show');
        return true;
    }

    function validateHerdNumbers() {
        const total = parseInt(document.getElementById('total-horses').value) || 0;
        const exposed = parseInt(document.getElementById('exposed-horses').value) || 0;
        const sick = parseInt(document.getElementById('sick-horses').value) || 0;
        const dead = parseInt(document.getElementById('dead-horses').value) || 0;
        let isValid = true;

        if (exposed > total) { document.getElementById('exposed-horses-error').classList.add('show'); isValid = false; } 
        else { document.getElementById('exposed-horses-error').classList.remove('show'); }
        if (sick > exposed) { document.getElementById('sick-horses-error').classList.add('show'); isValid = false; }
        else { document.getElementById('sick-horses-error').classList.remove('show'); }
        if (dead > sick) { document.getElementById('dead-horses-error').classList.add('show'); isValid = false; }
        else { document.getElementById('dead-horses-error').classList.remove('show'); }
        return isValid;
    }

    function validatePart1() {
        let isValid = true;
        isValid = validateField('responsible-name', 'responsible-name-error', 'Nome √© obrigat√≥rio.') && isValid;
        isValid = validateField('telefone', 'telefone-error', 'Telefone √© obrigat√≥rio.') && isValid;
        isValid = validateField('farm-name', 'farm-name-error', 'Nome da propriedade √© obrigat√≥rio.') && isValid;
        isValid = validateField('location', 'location-error', 'Localiza√ß√£o √© obrigat√≥ria.') && isValid;
        isValid = validateField('total-horses', 'total-horses-error', 'N√∫mero total √© obrigat√≥rio.') && isValid;
        isValid = validateHerdNumbers() && isValid;

        if (isValid) {
            savePropertyData();
            goToPart2();
        } else {
            alert('Por favor, corrija os erros antes de continuar.');
        }
    }

    function formatarTelefone(input) {
        let value = input.value.replace(/\D/g, '');
